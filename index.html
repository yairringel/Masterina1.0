<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Gyro </title>

</head>
<script type="text/javascript" src="masterina.js"></script>

<style>
 /body 
  {
  	
	margin: 0px;
	padding: 0px;
	font-size:60px;
	position: fixed;
}
  canvas
  { 
	margin: 0px;
	padding: 0px;
	position:fixed;
	left:0px;
    top:0px;
	
  } 
 img
  { 
	margin: 0px;
	padding: 0px;
	position:fixed;
	
  } 
  input
  {
    margin: 0px;
	padding: 0px;
	position:fixed;
  }
  
</style>
 

<body >
	
	alpha:<span id="alpha" style="position:fixed;"></span><br>
	beta:<span id="beta" style="position:fixed;"></span><br>
	gamma:<span id="gamma" style="position:fixed;"></span><br>
	L1:<span id="X"></span><br>
	Y:<span id="Y" style ="position:fixed; z-index: 0;"></span><br>
	Z:<span id="Z" style ="position:fixed; z-index:0;"></span><br>
	<canvas id="myCanvas" style=" border:6px solid;z-index: -10; "></canvas> 
	<canvas id="myCanvas2" style="  z-index: -11; "></canvas> 
	<img id="img1" src="frame.jpg" style ="z-index: 2;">
	<img id="img2" src="space1.jpg" style ="top:-1px ; left:-1px ;z-index: 1;">
	<input id="lockScreen" type="image" src="screenLock.png"  style= "width:500px; height:500px; z-index: 5" onclick="funcLock()"></input>
	<input id="lineThik" type="image" src="thik1.png"  style= "width:150px; height:150px; z-index: 6" onclick="funcLineThik()"></input>
	<input id="pieType" type="image" src="pie1.png"  style= "width:150px; height:150px; z-index: 6" onclick="funcPieType()"></input>
	<input id="Mirror" type="image" src="mirror1.png"  style= "width:150px; height:150px; z-index: 6" onclick="funcMirror()"></input>
	<input id="Color" type="image" src="color.png"  style= " z-index: 6" onclick="funcColor()" ></input>
	
	
</body>
<script type="text/javascript">
//============================================================================ btn func============================================================================
document.addEventListener("touchStart", touchStartFunc, true);//?misspelled
document.addEventListener("touchmove", touchmoveFunc, true);
document.addEventListener("touchend", touchEndFunc, true);
	var iMirror=0;
	var iLineThik=0;
	var iPieType=0;
	function funcLock()
	{
		document.getElementById("lockScreen").style.zIndex  =-1;
		document.getElementById("myCanvas").style.zIndex  =4;
		document.getElementById("myCanvas2").style.zIndex  =3;
		positioning();
	}
	function funcLineThik()
	{
		iLineThik+=1;
		lineThik=thikRa[iLineThik];
		document.getElementById("lineThik").src  =lineThikArray[iLineThik].src;
		if (iLineThik==5)
		{
			iLineThik=-1;
			
		}
	}
	function funcPieType()
	{
		iPieType+=1;
		pieType=pieTypeRA[iPieType];
		document.getElementById("pieType").src  =pieTypeArray[iPieType].src;
		if (iPieType==5)
		{
			iPieType=-1;
			
		}
	}
	function funcMirror()
	{
		iMirror+=1;
		mirror=mirrorRA[iMirror];
		document.getElementById("Mirror").src  =mirrorArray[iMirror].src;
		if (iMirror==1)
		{
			iMirror=-1;
			
		}
	}
	function funcColor()
	{
		color = true;
	}
 //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	//================================================================================ VAR ===============================================================================================
    var sWidth,sHeight,c1Width,c1Height,imgWidth,imgHeight,c2Width,c2Height,lineThik=1,pieType=1;mirror=0;
    var crossLine=50;
    var c1Width
    var lineThikArray = new Array();
    lineThikArray[0] = new Image();lineThikArray[1] = new Image();lineThikArray[2] = new Image();lineThikArray[3] = new Image();lineThikArray[4] = new Image();lineThikArray[5] = new Image();
	lineThikArray[0].src = 'thik1.png';lineThikArray[1].src = 'thik2.png';lineThikArray[2].src = 'thik3.png';lineThikArray[3].src = 'thik4.png';lineThikArray[4].src = 'thik5.png';lineThikArray[5].src = 'thik6.png';
	var thikRa=[]
	thikRa[0]=1;thikRa[1]=2;thikRa[2]=4;thikRa[3]=10;thikRa[4]=17;thikRa[5]=25;
	
	
	var pieTypeArray = new Array();
	pieTypeArray[0] = new Image();pieTypeArray[1] = new Image();pieTypeArray[2] = new Image();pieTypeArray[3] = new Image();pieTypeArray[4] = new Image();pieTypeArray[5] = new Image(); 
	pieTypeArray[0].src = 'pie1.png';pieTypeArray[1].src = 'pie3.png';pieTypeArray[2].src = 'pie4.png';pieTypeArray[3].src = 'pie6.png';pieTypeArray[4].src = 'pie12.png';pieTypeArray[5].src = 'pie16.png';
	var pieTypeRA=[];
	pieTypeRA[0]=1;pieTypeRA[1]=3;pieTypeRA[2]=4;pieTypeRA[3]=6;pieTypeRA[4]=10;pieTypeRA[5]=16;

	var mirrorArray = new Array();
	mirrorArray[0] = new Image();mirrorArray[1] = new Image();
	mirrorArray[0].src = 'mirror1.png';mirrorArray[1].src = 'mirror2.png';
	var mirrorRA=[];
	mirrorRA[0]=1;mirrorRA[1]=2;

    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var canvas2 = document.getElementById('myCanvas2');
    var context2 = canvas2.getContext('2d');

    
    var width=window.innerWidth;
    var height=window.innerHeight;
    c1Width=width;
    c1Height=height;
    context.canvas.width  = width;//resize canvas to whatever window dimensions are
	context.canvas.height = height;
   	context.translate(canvas.width / 2, canvas.height / 2); 
   	var pointsX=[]; var pointsY=[]; var lastPointX=[];var lastPointY=[];var pointsXm=[]; var pointsYm=[]; var lastPointXm=[];var lastPointYm=[];
    var startMove=false;
    
    var deviceOrientationData ={alpha:0,beta:0,gamma:0};//init with 0 as defaults 
    var first=0; 
    var color= false; 
    var x=0;
    var y=0;
    var z=0;
    var startY;
    var startZ;
    var frameBorderW=15;
    var frameBorderH=11;
    var imageBorder=40;
    var L1=900;
    var bitTouch=false;
    var userX=0;
	var userY=0;
	var firstX=0;
	var firstY=0;
	var prevTouchX=-1;
	var prevTouchY=-1;
	var btnLeftSpace=200;
	var btnTopSpace=180;
	document.getElementById("lockScreen").style.top  =(height/2)-250+"px";
	document.getElementById("lockScreen").style.left  = (width/2)-250+"px";
    document.getElementById("img2").width  =1.5*width;
    document.getElementById("img2").height  =1.5*height;
    document.getElementById("img2").style.top  =-300+"px";
    document.getElementById("img2").style.left  =-300+"px";
    document.getElementById("img1").width  =width-imageBorder*2;
    document.getElementById("img1").height  =height-imageBorder*2;
    //document.getElementById("Color").width  =width-imageBorder*2;
    document.getElementById("Color").height  = document.getElementById("img1").height+30;

    var imgWidth=document.getElementById("img1").width;
    var imgHeight=document.getElementById("img1").height;

    
    c2Width=imgWidth-(imgWidth*frameBorderW*2/100);
    c2Height=imgHeight-(imgHeight*frameBorderH*2/100);
	context2.canvas.width  = c2Width;//resize canvas to whatever window dimensions are
	context2.canvas.height = c2Height;
	context2.translate(canvas2.width / 2, canvas2.height / 2);

//=======================================================================================================================================================================
//============================================================================================================FUNC ======================================================
//=======================================================================================================================================================================

  
function positioning()
{
	document.getElementById("lineThik").style.left  =-x-120+"px";
	document.getElementById("lineThik").style.top  = y+10+"px";	
	document.getElementById("img2").style.left  =-x/10-300+"px";
	document.getElementById("img2").style.top  = y/10-300+"px";	
	document.getElementById("img1").style.left  =-x+ width/2-imgWidth/2+"px";
	document.getElementById("img1").style.top  = y+height/2-imgHeight/2+"px";
	document.getElementById("myCanvas2").style.left  =-x+ width/2-imgWidth/2+(imgWidth*frameBorderW/100)+"px";
	document.getElementById("myCanvas2").style.top  = y+height/2-imgHeight/2+(imgHeight*frameBorderH/100)+"px";
	document.getElementById("lineThik").style.left  =-x/0.7-btnLeftSpace+"px";
	document.getElementById("lineThik").style.top  =  y/0.7+height/2-imgHeight/2-20+"px";//same as img 1 top	
	document.getElementById("pieType").style.left  =-x/0.7-btnLeftSpace+"px";
	document.getElementById("pieType").style.top  =  y/0.7+height/2-imgHeight/2+btnTopSpace-20+"px";//same as img 1 top	
	document.getElementById("Mirror").style.left  =-x/0.7-btnLeftSpace+"px";
	document.getElementById("Mirror").style.top  =  y/0.7+height/2-imgHeight/2+btnTopSpace*2-20+"px";//same as img 1 top	

	document.getElementById("Color").style.left  =-x/0.7+ width/2+imgWidth/2+130+"px";
	document.getElementById("Color").style.top  = y/0.7+height/2-imgHeight/2-20+"px";

	document.getElementById("alpha").innerHTML=alpha;
	document.getElementById("beta").innerHTML=startY;
	document.getElementById("gamma").innerHTML =startZ;
	document.getElementById("X").innerHTML =prevTouchX;
	document.getElementById("Y").innerHTML =userY;
	document.getElementById("Z").innerHTML =color;
}

if (window.DeviceOrientationEvent) 
    {//
    	
    	window.addEventListener("deviceorientation", function () {//gyro
    	if (first==0)
    	{
    		startZ=Math.cos(degToRad(event.beta))*L1;
    		startY=Math.sin(degToRad(event.beta))*L1;
    		first=1;	
    	}	
    	
        processGyro(event.alpha, event.beta, event.gamma); 
    	}, true);
    	
}

function drawPie(drawX,drawY)
{

	if (startMove==false)
	    {	
	    	for (var ii=1; ii < pieType+1; ii++)
	    	 {
	    		lastPointX[ii]=drawX*Math.cos(2*Math.PI/pieType*ii)+drawY*Math.sin(2*Math.PI/pieType*ii)
	    		lastPointY[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)-drawX*Math.sin(2*Math.PI/pieType*ii)
				if (mirror==2)
	    			{
	    			if (pieType==1)
	    				{
	    				lastPointXm[ii]=-(drawX*Math.cos(2*Math.PI/pieType*ii)+drawY*Math.sin(2*Math.PI/pieType*ii))
	    				lastPointYm[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)-drawX*Math.sin(2*Math.PI/pieType*ii)

	    				}
	    			else{
	    				lastPointXm[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)+drawX*Math.sin(2*Math.PI/pieType*ii)
	    				lastPointYm[ii]=drawX*Math.cos(2*Math.PI/pieType*ii)-drawY*Math.sin(2*Math.PI/pieType*ii)
	    				}
	    			}
	    	}
	    	
	    }	

	    
	for (var iii=1; iii < pieType+1; iii++)
		 {
		
    		pointsX[iii]=drawX*Math.cos(2*Math.PI/pieType*iii)+drawY*Math.sin(2*Math.PI/pieType*iii)
    		pointsY[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)-drawX*Math.sin(2*Math.PI/pieType*iii)
    		if (mirror==2)
    			{
    				if (pieType==1)
    					{
    						pointsXm[iii]=-(drawX*Math.cos(2*Math.PI/pieType*iii)+drawY*Math.sin(2*Math.PI/pieType*iii))
    						pointsYm[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)-drawX*Math.sin(2*Math.PI/pieType*iii)
    					}
    				else
    					{
    						pointsXm[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)+drawX*Math.sin(2*Math.PI/pieType*iii)
    						pointsYm[iii]=drawX*Math.cos(2*Math.PI/pieType*iii)-drawY*Math.sin(2*Math.PI/pieType*iii)
    					}
    			}
    	}
 for (var iiii=1; iiii < pieType+1; iiii++) {
    	console.log(drawY);
		context2.beginPath();
	    context2.lineWidth = lineThik;
	    context2.moveTo(lastPointX[iiii],lastPointY[iiii]);
		context2.lineTo(pointsX[iiii],pointsY[iiii]);
		context2.lineCap = 'round';
	    context2.strokeStyle = '#000000';
	    context2.stroke(); 
	    if (mirror==2){
		    context2.beginPath();
		    context2.lineWidth = lineThik;
		    context2.moveTo(lastPointXm[iiii],lastPointYm[iiii]);
			context2.lineTo(pointsXm[iiii],pointsYm[iiii]);
			context2.lineCap = 'round';
		    context2.strokeStyle = '#000000';
		    context2.stroke(); 
		}
	    } 
	for (var iiiii=1; iiiii < pieType+1; iiiii++) {
	    lastPointX[iiiii]=pointsX[iiiii];
	    lastPointY[iiiii]=pointsY[iiiii];
	    if (mirror==2){
	    	
	    	lastPointXm[iiiii]=pointsXm[iiiii];
	    	lastPointYm[iiiii]=pointsYm[iiiii];
	    }
	   startMove=true;
	}
}
	



function processGyro(alpha,beta,gamma)
{ 
	deviceOrientationData.alpha=alpha;
	deviceOrientationData.beta=beta;
	deviceOrientationData.gamma=gamma;
	
	context.save();
	context.setTransform(1, 0, 0, 1, 0, 0);
	context.clearRect(0, 0, canvas.width, canvas.height);
	context.restore();
	console.log(userX);
	drawCir(userX,userY);

	if (bitTouch)
	{
		
	}
	else
	{
		rotatePointViaGyroEulars(0,startY,startZ);
	}
	
	positioning();		
	

}



function degToRad(deg)// Degree-to-Radian conversion
{
	 return deg * Math.PI / 180; 
}




//========================================================================================================================================================================
//======================================================================TOUCH==================================================================================================



function touchStartFunc(e)
{
	
}

function touchmoveFunc(e)
{
	if (!(color))
	{
		if( navigator.userAgent.match(/Android/i) ) //stupid android bug cancels touch move if it thinks there's a swipe happening
		{   
		  e.preventDefault();
		}
		
		userX=e.touches[0].clientX-firstX;
		userY=e.touches[0].clientY-firstY;
		
		if (!(bitTouch))
		{
			
			firstX=e.touches[0].clientX;
			firstY=e.touches[0].clientY;
			
		}
		if (bitTouch){
			drawPie(userX+x,userY-y)
			
		}
		bitTouch=true;
	} 
}

function touchEndFunc(e)
{
	
  
  userX=0;
	userY=0;
	bitTouch=false;
	startMove=false;
	color=false;
}

//====================================================================MOUSE=================================================================
document.addEventListener("mousedown", mouseDownFunc, true);
document.addEventListener("mousemove", mouseMoveFunc, true);
document.addEventListener("mouseup", mouseUpFunc, true);

function mouseDownFunc(e)
{
  bitTouch=true;
}

function mouseMoveFunc(e)
{	
	userX=e.clientX-firstX;
	userY=e.clientY-firstY;
	if (!(bitTouch))
	{
		firstX=e.clientX;
		firstY=e.clientY;
	}
	if (bitTouch){
		drawPie(userX,userY)
		
	}
}

function mouseUpFunc(e)
{
   userX=0;
	userY=0;
	bitTouch=false;
	startMove=false;
	
}

		
 </script>
</html>
<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Gyro </title>

</head>


<style>
 /body 
  {
  	
	margin: 0px;
	padding: 0px;
	font-size:60px;
	position: fixed;
}
  canvas
  { 
	margin: 0px;
	padding: 0px;
	position:fixed;
	left:0px;
    top:0px;
	
  } 
 img
  { 
	margin: 0px;
	padding: 0px;
	position:fixed;
	
  } 
  input
  {
    margin: 0px;
	padding: 0px;
	position:fixed;
  }
  
</style>
 

<body >
	
	alpha:<span id="alpha" style="position:fixed;"></span><br>
	beta:<span id="beta" style="position:fixed;"></span><br>
	gamma:<span id="gamma" style="position:fixed;"></span><br>
	L1:<span id="X"></span><br>
	Y:<span id="Y" style ="position:fixed; z-index: 0;"></span><br>
	Z:<span id="Z" style ="position:fixed; z-index: 0;"></span><br>
	<canvas id="myCanvas" style=" border:6px solid;z-index: -10; "></canvas> 
	<canvas id="myCanvas2" style="  z-index: -11; "></canvas> 
	<img id="img1" src="frame.jpg" style ="z-index: 2;">
	<img id="img2" src="space.jpg" style ="top:-1px ; left:-1px ;z-index: 1;">
	<input id="lockScreen" type="image" src="screenLock.png"  style= "width:500px; height:500px; z-index: 5" onclick="funcLock()"></input>
	<input id="lineThik" type="image" src="thik1.png"  style= "width:150px; height:150px; z-index: 6" onclick="funcLineThik()"></input>
	
	
</body>
<script type="text/javascript">
//============================================================================ btn func============================================================================
	iLineThik=0;
	function funcLock()
	{
		document.getElementById("lockScreen").style.zIndex  =-1;
		document.getElementById("myCanvas").style.zIndex  =4;
		document.getElementById("myCanvas2").style.zIndex  =3;
	}
	function funcLineThik()
	{
		iLineThik+=1;
		lineWidth=thikRa[iLineThik];
		document.getElementById("lineThik").src  =lineWidthArray[iLineThik].src;
		
		
		if (iLineThik==5)
		{
			iLineThik=-1;
			
		}

		console.log(lineWidth);
	}
 //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	//================================================================================ VAR ===============================================================================================
    var sWidth,sHeight,c1Width,c1Height,imgWidth,imgHeight,c2Width,c2Height,lineWidth=1;
    var crossLine=50;
    var c1Width
    var lineWidthArray = new Array();
    lineWidthArray[0] = new Image();lineWidthArray[1] = new Image();lineWidthArray[2] = new Image();lineWidthArray[3] = new Image();lineWidthArray[4] = new Image();lineWidthArray[5] = new Image();
	lineWidthArray[0].src = 'thik1.png';lineWidthArray[1].src = 'thik2.png';lineWidthArray[2].src = 'thik3.png';lineWidthArray[3].src = 'thik4.png';lineWidthArray[4].src = 'thik5.png';lineWidthArray[5].src = 'thik6.png';
	var thikRa=[];
	thikRa[0]=1;thikRa[1]=2;thikRa[2]=4;thikRa[3]=10;thikRa[4]=17;thikRa[5]=25;
	
	lineWidthArray[1].src = 'thik2.png';

    document.addEventListener("touchStart", touchStartFunc, true);//?misspelled
	document.addEventListener("touchmove", touchmoveFunc, true);
	document.addEventListener("touchend", touchEndFunc, true);

    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var canvas2 = document.getElementById('myCanvas2');
    var context2 = canvas2.getContext('2d');

    
    var width=window.innerWidth;
    var height=window.innerHeight;
    c1Width=width;
    c1Height=height;
    context.canvas.width  = width;//resize canvas to whatever window dimensions are
	context.canvas.height = height;
   	context.translate(canvas.width / 2, canvas.height / 2); 
    var lastXX=-1;
    var lastYY=-1;
    var deviceOrientationData ={alpha:0,beta:0,gamma:0};//init with 0 as defaults 
    var first=0;  
    var x=0;
    var y=0;
    var z=0;
    var startY;
    var startZ;
    var frameBorderW=15;
    var frameBorderH=11;
    var imageBorder=40;
    var L1=1200;
    var bitTouch=false;
    var userX=0;
	var userY=0;
	var firstX=0;
	var firstY=0;
	var prevTouchX=-1;
	var prevTouchY=-1;
	document.getElementById("lockScreen").style.top  =(height/2)-250+"px";
	document.getElementById("lockScreen").style.left  = (width/2)-250+"px";
    document.getElementById("img2").width  =1.5*width;
    document.getElementById("img2").height  =1.5*height;
    document.getElementById("img2").style.top  =-300+"px";
    document.getElementById("img2").style.left  =-300+"px";
    document.getElementById("img1").width  =width-imageBorder*2;
    document.getElementById("img1").height  =height-imageBorder*2;

    var imgWidth=document.getElementById("img1").width;
    var imgHeight=document.getElementById("img1").height;

    console.log(width);
    console.log(height);
    c2Width=imgWidth-(imgWidth*frameBorderW*2/100);
    c2Height=imgHeight-(imgHeight*frameBorderH*2/100);
	context2.canvas.width  = c2Width;//resize canvas to whatever window dimensions are
	context2.canvas.height = c2Height;
	context2.translate(canvas2.width / 2, canvas2.height / 2);

//=======================================================================================================================================================================
//============================================================================================================FUNC ======================================================
//=======================================================================================================================================================================
    if (window.DeviceOrientationEvent) 
    {//
    	
    	window.addEventListener("deviceorientation", function () {//gyro
    	if (first==0)
    	{
    		startZ=Math.cos(degToRad(event.beta))*L1;
    		startY=Math.sin(degToRad(event.beta))*L1;
    		first=1;	
    	}	
    	
        processGyro(event.alpha, event.beta, event.gamma); 
    	}, true);
    	
	}

	

	function drawCir(xx,yy)
	{
		
		context.beginPath();
	    context.lineWidth = 2;
	    context.moveTo(xx-crossLine,yy-1);
		context.lineTo(xx+crossLine, yy-1);
		context.moveTo(xx-1,crossLine+yy);
		context.lineTo(xx-1,-crossLine+yy);
	    context.strokeStyle = '#000000';
	    context.stroke(); 
	    context.beginPath();
	    context.moveTo(xx-crossLine,yy+1);
		context.lineTo(xx+crossLine, yy+1);
		context.moveTo(xx+1,crossLine+yy);
		context.lineTo(xx+1,-crossLine+yy);
	    context.strokeStyle = '#ffffff';
	    context.stroke(); 
	    context.beginPath();
	    context.arc(xx, yy, lineWidth, 0, 2 * Math.PI, false);
		context.fillStyle = '#000000';
	    context.fill();  
	}
	function drawCir2(xx,yy)
	{
		//context2.beginPath();
	    //context2.arc(xx, yy, lineWidth, 0, 2 * Math.PI, false);
		// context.fillStyle = 'green';
	    //context.fill();
	    //context2.lineWidth = 2;
	    //context2.strokeStyle = '#003300';
	    //context2.stroke();  
	    if (lastXX== -1)
	    {
	    	lastXX=xx; lastYY=yy;
	    }	

	    context2.beginPath();
	    context2.lineWidth = lineWidth;
	    context2.moveTo(lastXX,lastYY);
		context2.lineTo(xx,yy);
		context2.lineCap = 'round';
	    context2.strokeStyle = '#000000';
	    context2.stroke();  
	    lastXX=xx;
	    lastYY=yy;
	    
	}


function processGyro(alpha,beta,gamma)
{ 
	deviceOrientationData.alpha=alpha;
	deviceOrientationData.beta=beta;
	deviceOrientationData.gamma=gamma;
	rotatePointViaGyroEulars(0,startY,startZ);
	
	if (bitTouch)
	{
		drawCir2(userX+x,userY-y,prevTouchX+x,prevTouchY-y);	
	}
		context.save();
		context.setTransform(1, 0, 0, 1, 0, 0);
		context.clearRect(0, 0, canvas.width, canvas.height);
		context.restore();
		drawCir(0+userX,0+userY);
	document.getElementById("lineThik").style.left  =-x-120+"px";
	document.getElementById("lineThik").style.top  = y+10+"px";	
	document.getElementById("img2").style.left  =-x/10-300+"px";
	document.getElementById("img2").style.top  = y/10-300+"px";	
	document.getElementById("img1").style.left  =-x+ width/2-imgWidth/2+"px";
	document.getElementById("img1").style.top  = y+height/2-imgHeight/2+"px";
	document.getElementById("myCanvas2").style.left  =-x+ width/2-imgWidth/2+(imgWidth*frameBorderW/100)+"px";
	document.getElementById("myCanvas2").style.top  = y+height/2-imgHeight/2+(imgHeight*frameBorderH/100)+"px";
	document.getElementById("lineThik").style.left  =-x-180+"px";
	document.getElementById("lineThik").style.top  = document.getElementById("img1").style.top ;	
	
	document.getElementById("alpha").innerHTML=alpha;
	document.getElementById("beta").innerHTML=startY;
	document.getElementById("gamma").innerHTML =startZ;
	document.getElementById("X").innerHTML =prevTouchX;
	document.getElementById("Y").innerHTML =userX+x;
	document.getElementById("Z").innerHTML =prevTouchX+x;

}



function degToRad(deg)// Degree-to-Radian conversion
{
	 return deg * Math.PI / 180; 
}


function rotatePointViaGyroEulars(a,b,c) //rotates 3d point based on eular angles
{
	var oldX=0;
	var oldY=-startY;
	var oldZ=startZ;
	
	//order here is important - it must match the processing order of the device
	
	//rotate about z axis
	var newX = oldX * Math.cos(-degToRad(deviceOrientationData.alpha)) - oldY * Math.sin(-degToRad(deviceOrientationData.alpha));
	var newY = oldY * Math.cos(-degToRad(deviceOrientationData.alpha)) + oldX * Math.sin(-degToRad(deviceOrientationData.alpha));
	
	//rotate about x axis
	oldY=newY;
	newY = oldY * Math.cos(-degToRad(deviceOrientationData.beta)) - oldZ * Math.sin(-degToRad(deviceOrientationData.beta));
	var newZ = oldZ * Math.cos(-degToRad(deviceOrientationData.beta)) + oldY * Math.sin(-degToRad(deviceOrientationData.beta));

	
	//rotate about y axis
	oldZ=newZ;
	oldX=newX;

	newZ = oldZ * Math.cos(-degToRad(deviceOrientationData.gamma)) - oldX * Math.sin(-degToRad(deviceOrientationData.gamma));
	newX = oldX * Math.cos(-degToRad(deviceOrientationData.gamma)) + oldZ * Math.sin(-degToRad(deviceOrientationData.gamma));
	document.getElementById("alpha").innerHTML=oldZ;
	x=newX;
	y=newY;
	z=newZ;

	
}
function computeQuaternionFromEulers(alpha,beta,gamma)//Alpha around Z axis, beta around X axis and gamma around Y axis intrinsic local space in that order(each axis moves depending on how the other moves so processing order is important)
{
	var qx = degToRad(beta) ; // beta value
	var qy = degToRad(gamma) ; // gamma value
	var qz = degToRad(alpha) ; // alpha value

	//precompute to save on processing time
	var cX = Math.cos( x/2 );
	var cY = Math.cos( y/2 );
	var cZ = Math.cos( z/2 );
	var sX = Math.sin( x/2 );
	var sY = Math.sin( y/2 );
	var sZ = Math.sin( z/2 );

	var qw = cX * cY * cZ - sX * sY * sZ;
	var qx = sX * cY * cZ - cX * sY * sZ;
	var qy = cX * sY * cZ + sX * cY * sZ;
	var qz = cX * cY * sZ + sX * sY * cZ;

	x=qx;
	y=qy;
	z=qz;	  
}
window.addEventListener('orientationchange', function () {
    if (window.orientation == -90) {
        document.getElementById('orient').className = 'orientright';
    }
    if (window.orientation == 90) {
        document.getElementById('orient').className = 'orientleft';
    }
    if (window.orientation == 0) {
        document.getElementById('orient').className = '';
    }
}, true);
//========================================================================================================================================================================
//========================================================================================================================================================================


function touchStartFunc(e)
{
	
}

function touchmoveFunc(e)
{
	
	if( navigator.userAgent.match(/Android/i) ) //stupid android bug cancels touch move if it thinks there's a swipe happening
	{   
	  e.preventDefault();
	}
	userXYmove(e.touches[0].clientX,e.touches[0].clientY);
	if (!(bitTouch))
	{
		
		firstX=e.touches[0].clientX;
		firstY=e.touches[0].clientY;
	}
	bitTouch=true;
	 prevTouchX =e.touches[0].clientX;
	 prevTouchY =e.touches[0].clientY;
}

function touchEndFunc(e)
{
	
  prevTouchX = -1;
  prevTouchY = -1;
  userX=0;
	userY=0;
	bitTouch=false;
	lastXX= -1; lastYY= -1;
}
function userXYmove(ux,uy)
{

	
	
	if(prevTouchX != -1 ) //need valid prevTouch info to calculate swipe
	{
	  var xMovement=ux-prevTouchX;
	  var yMovement=uy-prevTouchY;
	  userX=ux-firstX;
	  userY=uy-firstY;
	  //var xMovementQuat=quatFromAxisAngle(1,0,0,y/200);//movement on y rotates x and vice versa
	  //var yMovementQuat=quatFromAxisAngle(0,1,0,x/200);//200 is there to scale the movement way down to an intuitive amount
	 //userQuot=quaternionMultiply([yMovementQuat,xMovementQuat]);//use reverse order
	 
	}
	prevTouchY=uy;
	prevTouchX=ux;
}

		
 </script>
</html>
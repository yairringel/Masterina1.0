<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Gyro </title>

</head>
<script type="text/javascript" src="masterina.js"></script>
<script type="text/javascript" src="jquery.js"></script>

<style>
 

 /body 
  {
  	
	margin: 0px;
	padding: 0px;
	font-size:120px;
	position: fixed;
}
  canvas
  { 

    

	margin: 0px;
	padding: 0px;
	position:fixed;
	left:0px;
    top:0px;
	
  } 
 img
  { 
  	cursor:auto;
	margin: 0px;
	padding: 0px;
	position:fixed;
	
  } 
  input
  {
    margin: 0px;
	padding: 0px;
	position:fixed;
  }
  
</style>
 

<body >
	
	alpha:<span id="alpha" style="position:fixed; z-index: 8;"></span><br>
	beta:<span id="beta" style="position:fixed; z-index: 8;"></span><br>
	gamma:<span id="gamma" style="position:fixed;z-index: 8;"></span><br>
	L1:<span id="X"></span><br>
	Y:<span id="Y" style ="position:fixed; z-index: 0;"></span><br>
	Z:<span id="Z" style ="position:fixed; z-index:0;"></span><br>
	<canvas id="myCanvas" style="top:0px;left:0px; z-index: 2; "></canvas> 
	<canvas id="myCanvas2" style="top:0px;left:0px; z-index: 1; "></canvas> 
	<canvas id="Color" type="image" style="width:8%;height:16%;left:91%;top:18%;  z-index: 6; "></canvas>
	<canvas id="ColorShow" src="frame.jpg" style="width:8%;height:4%;left:91%;top:11%;  z-index: 3; "></canvas> 
	
	
	<img id="spaceImg" src="space1.jpg" style ="top:-1px ; left:-1px ;z-index: 1;">
	<img id="sideImg" src="side1.png" style = "top:10%;width:10%;height:100%; left: 0%;z-index: 2;">
	<img id="side2Img" src="side.png" style = "top:10%;width:10%;height:100%; left: 90%;z-index: 2;">
	<img id="topImg" src="bottom1.png" style = "top:0%; width:100%;height:10%;left: 0%;z-index: 2;">
	<img id="masterinaLogo" src="LOGO1.png" style = "top:1%;left: 1%;height:8%;z-index: 2;">
	<img id="bottomImg" src="bottom.png" style = "top:90%; width:100%;height:10%;left: 0%;z-index: 2;">
	
	<input id="New" type="image" src="NEW_BTN.png"  style= "top:11%; left: 1%; width:8%; height:4%; z-index: 6" onclick="funcNew()"></input>
	<input id="lineThik" type="image" src="thik1.png"  style= "top:18%; left: 1%; width:8%; height:width; z-index: 6" onclick="funcLineThik()"></input>
	<input id="pieType" type="image" src="pie1.png"  style= "top:34%; left: 1%; width:8%; height:width; z-index: 6" onclick="funcPieType()"></input>
	<input id="Mirror" type="image" src="mirror1.png"  style= "top:50%; left: 1%; width:8%; height:width; z-index: 6" onclick="funcMirror()"></input>
	
	
	
	
	
</body>
<script type="text/javascript">





//============================================================================ btn func============================================================================
document.addEventListener("touchStart", touchStartFunc, true);//?misspelled
document.addEventListener("touchmove", touchmoveFunc, true);
document.addEventListener("touchend", touchEndFunc, true);
	var iMirror=0;
	var iLineThik=0;
	var iPieType=0;
	function funcNew()
	{
		context2.clearRect(-canvas2.width, -canvas2.height, canvas2.width*2, canvas2.height*2);
	}
	function funcLineThik()
	{
		iLineThik+=1;
		lineThik=thikRa[iLineThik];
		document.getElementById("lineThik").src  =lineThikArray[iLineThik].src;
		if (iLineThik==5)
		{
			iLineThik=-1;
			
		}
	}
	function funcPieType()
	{
		iPieType+=1;
		pieType=pieTypeRA[iPieType];
		document.getElementById("pieType").src  =pieTypeArray[iPieType].src;
		if (iPieType==5)
		{
			iPieType=-1;
			
		}
	}
	function funcMirror()
	{
		iMirror+=1;
		mirror=mirrorRA[iMirror];
		document.getElementById("Mirror").src  =mirrorArray[iMirror].src;
		if (iMirror==1)
		{
			iMirror=-1;
			
		}
	}
	function funcColor()
	{
		
		color=true;
		
	}
 //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	
    //------------------------------------------------------------------------------- STATIC ----------------------------------------------------------------------------------------------
    var sWidth,sHeight,c1Width,c1Height,imgWidth,imgHeight,c2Width,c2Height,lineThik=1,pieType=1;mirror=0;
    var crossLine=50;
    
    var lineThikArray = new Array();
    lineThikArray[0] = new Image();lineThikArray[1] = new Image();lineThikArray[2] = new Image();lineThikArray[3] = new Image();lineThikArray[4] = new Image();lineThikArray[5] = new Image();
	lineThikArray[0].src = 'thik1.png';lineThikArray[1].src = 'thik2.png';lineThikArray[2].src = 'thik3.png';lineThikArray[3].src = 'thik4.png';lineThikArray[4].src = 'thik5.png';lineThikArray[5].src = 'thik6.png';
	var thikRa=[]
	thikRa[0]=1;thikRa[1]=2;thikRa[2]=4;thikRa[3]=10;thikRa[4]=17;thikRa[5]=25;
	
	
	var pieTypeArray = new Array();
	pieTypeArray[0] = new Image();pieTypeArray[1] = new Image();pieTypeArray[2] = new Image();pieTypeArray[3] = new Image();pieTypeArray[4] = new Image();pieTypeArray[5] = new Image(); 
	pieTypeArray[0].src = 'pie1.png';pieTypeArray[1].src = 'pie3.png';pieTypeArray[2].src = 'pie4.png';pieTypeArray[3].src = 'pie6.png';pieTypeArray[4].src = 'pie12.png';pieTypeArray[5].src = 'pie16.png';
	var pieTypeRA=[];
	pieTypeRA[0]=1;pieTypeRA[1]=3;pieTypeRA[2]=4;pieTypeRA[3]=6;pieTypeRA[4]=10;pieTypeRA[5]=16;

	var mirrorArray = new Array();
	mirrorArray[0] = new Image();mirrorArray[1] = new Image();
	mirrorArray[0].src = 'mirror1.png';mirrorArray[1].src = 'mirror2.png';
	var mirrorRA=[];
	mirrorRA[0]=1;mirrorRA[1]=2;

    //================================================================================ VAR ===============================================================================================
	
    var staticBit=true;
    var width=window.innerWidth;
    var height=window.innerHeight;


   


    var sideW=0.1*width; topH=0.05*height;
    var frameWper=0.8,frameHper=0.8,frameW=width*frameWper,frameH=height*frameHper,frameXpos=(width-width*frameWper)/2,frameYpos=(height-height*frameHper)/2;
    var canvasWper=0.75,canvasHper=0.75,canvasW=width*canvasWper,canvasH=height*canvasHper,canvasXpos=(width-width*canvasWper)/2,canvasYpos=(height-height*canvasHper)/2;
    var btnSizeper=0.07,btnW=width*btnSizeper,btnH=btnW,btnLeftSpace=15,btnTopSpace=0.06*height,btnBottomSpace=0.05*height,btnRightSpace=width*0.05,btn2btnSpace=width*0.03;
    var btnLineXpos=-btnLeftSpace,btnLineYpos=frameYpos;
    var btnPyeXpos=-btnLeftSpace,btnPyeYpos=frameYpos+(btnTopSpace+btnH)*1;
    var btnMirXpos=-btnLeftSpace,btnMirYpos=frameYpos+(btnTopSpace+btnH)*2;

    document.getElementById("spaceImg").width  =1.5*width;
    document.getElementById("spaceImg").height  =1.5*height;
    document.getElementById("spaceImg").style.top  =-300+"px";
    document.getElementById("spaceImg").style.left  =-300+"px";
    document.getElementById("myCanvas").width  =2000;
    document.getElementById("myCanvas").height =1100;
    document.getElementById("myCanvas2").width  =2000;
    document.getElementById("myCanvas2").height =1100;
    
    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');
    var canvas2 = document.getElementById('myCanvas2');
    var context2 = canvas2.getContext('2d');
	context.translate(width/ 2, height / 2); 
	var centerOffsetX=width/2, centerOffsetY=height/2
	
	context2.translate(centerOffsetX, centerOffsetY);
   	var pointsX=[]; var pointsY=[]; var lastPointX=[];var lastPointY=[];var pointsXm=[]; var pointsYm=[]; var lastPointXm=[];var lastPointYm=[];
    var startMove=false;
    
    var canvasC = document.getElementById('Color');
	var contextC = canvasC.getContext('2d');
	var imageObj = new Image();
	imageObj.crossOrigin = 'anonymous'; 
	imageObj.src = 'colors.png'+ '?' + new Date().getTime();;
	imageObj.onload = function() 
	{
		contextC.drawImage(imageObj, 0, 0);
	};
	var colorShow = document.getElementById('ColorShow');
	var contextCS = colorShow.getContext('2d');
	contextCS.fillStyle = "rgb(255,0,0)";
	contextCS.fillRect(0, 0, width*0.08, height*0.04);


    var deviceOrientationData ={alpha:0,beta:0,gamma:0};//init with 0 as defaults 
    var first=0; 
    var touchX=0;
    var color=false;
    var chooseColor="000000";
    var x=0;
    var y=0;
    var z=0;
    var startY;
    var startZ;
    var frameBorderW=15;
    var frameBorderH=11;
    var imageBorder=40;
    var L1=900;
    var bitTouch=false;
    var userX=0;
	var userY=0;
	var firstX=0;
	var firstY=0;
	var prevTouchX=-1;
	var prevTouchY=-1;
	var btnLeftSpace=200;
	var btnTopSpace=180;
	var mouseX=0,mouseY=0;
	

	var masterina=
	{
		radius1:200,
		radius2:210,
		color:"000000",
		line:10,
		posX:width/2,
		posY:height/2,
		move:false,
		scale:false,
		draw:false,
		dX:0,
		dY:0
	}
  	 
	

//=======================================================================================================================================================================
//============================================================================================================FUNC ======================================================
//=======================================================================================================================================================================
$('#Color').mousemove(function(e) {
    
    var xxx = 10 ;
    var yyy = 10 ;
    
    var c = this.getContext('2d');
    var p = c.getImageData((mouseX-width*0.91)*300/(width*0.08), (mouseY-height*0.18)*150/(height*0.16), 1, 1).data; 
    var hex = "#" + ("000000" + rgbToHex(p[0], p[1], p[2])).slice(-6);
    contextCS.fillStyle = hex;
	contextCS.fillRect(0, 0, width*0.08, height*0.04);
    document.getElementById("alpha").innerHTML =(width*0.08);
	document.getElementById("beta").innerHTML =(height*0.04);
	document.getElementById("gamma").innerHTML =hex;

});
 window.onresize = function(event) // ============================ rsize =================================================================
    {
    	width=window.innerWidth;
    	height=window.innerHeight;
	};//===================================================================================================================================== 
function positioning()
{
	document.getElementById("lineThik").style.left  =-x-120+"px";
	document.getElementById("lineThik").style.top  = y+10+"px";	
	document.getElementById("spaceImg").style.left  =-x/10-300+"px";
	document.getElementById("spaceImg").style.top  = y/10-300+"px";	
	document.getElementById("sideImg").style.left  =-x+ 10%+"px";
	document.getElementById("sideImg").style.top  = y+0%+"px";
	document.getElementById("topImg").style.left  =-x+0%+"px";
	document.getElementById("topImg").style.top  = y+10%+"px";
	document.getElementById("lineThik").style.left  =-x+btnLineXpos+"px";
	document.getElementById("lineThik").style.top  =  y+btnLineYpos+"px";//same as img 1 top	
	document.getElementById("pieType").style.left  =-x+btnPyeXpos+"px";
	document.getElementById("pieType").style.top  =  y+btnPyeYpos+"px";//same as img 1 top	
	document.getElementById("Mirror").style.left  =-x+btnMirXpos+"px";
	document.getElementById("Mirror").style.top  =  y+btnMirYpos+"px";//same as img 1 top
	document.getElementById("Color").style.left  =-x/0.7+ width/2+imgWidth/2+60+"px";
	document.getElementById("Color").style.top  = y/0.7+height/2-imgHeight/2+"px";	
	if (color)
	{
		document.getElementById("myColorCanvas").style.left  =-x+ width/2-imgWidth/2+(imgWidth*frameBorderW/100)+"px";
		document.getElementById("myColorCanvas").style.top  = y+height/2-imgHeight/2+(imgHeight*frameBorderH/100)+"px";
	}
	else
	{
		document.getElementById("myColorCanvas").style.left  =-1000+"px";
	}
	document.getElementById("alpha").innerHTML=centerOffsetX;
	document.getElementById("beta").innerHTML=startY;
	document.getElementById("gamma").innerHTML =startZ;
	document.getElementById("X").innerHTML =btnLineXpos;
	document.getElementById("Y").innerHTML =btnLineYpos;
	document.getElementById("Z").innerHTML =0;
}

if (window.DeviceOrientationEvent) 
    {//
    	
    	window.addEventListener("deviceorientation", function () {//gyro
    	if (first==0)
    	{
    		startZ=Math.cos(degToRad(event.beta))*L1;
    		startY=Math.sin(degToRad(event.beta))*L1;
    		first=1;	
    	}	
    	
        processGyro(event.alpha, event.beta, event.gamma); 
    	}, true);
    	
}

function drawPie(drawX,drawY)
{

	if (startMove==false)
	    {	
	    	for (var ii=1; ii < pieType+1; ii++)
	    	 {
	    		lastPointX[ii]=drawX*Math.cos(2*Math.PI/pieType*ii)+drawY*Math.sin(2*Math.PI/pieType*ii)
	    		lastPointY[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)-drawX*Math.sin(2*Math.PI/pieType*ii)
				if (mirror==2)
	    			{
	    			if (pieType==1)
	    				{
	    				lastPointXm[ii]=-(drawX*Math.cos(2*Math.PI/pieType*ii)+drawY*Math.sin(2*Math.PI/pieType*ii))
	    				lastPointYm[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)-drawX*Math.sin(2*Math.PI/pieType*ii)

	    				}
	    			else{
	    				lastPointXm[ii]=drawY*Math.cos(2*Math.PI/pieType*ii)+drawX*Math.sin(2*Math.PI/pieType*ii)
	    				lastPointYm[ii]=drawX*Math.cos(2*Math.PI/pieType*ii)-drawY*Math.sin(2*Math.PI/pieType*ii)
	    				}
	    			}
	    	}
	    	
	    }	

	    
	for (var iii=1; iii < pieType+1; iii++)
		 {
		
    		pointsX[iii]=drawX*Math.cos(2*Math.PI/pieType*iii)+drawY*Math.sin(2*Math.PI/pieType*iii)
    		pointsY[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)-drawX*Math.sin(2*Math.PI/pieType*iii)
    		if (mirror==2)
    			{
    				if (pieType==1)
    					{
    						pointsXm[iii]=-(drawX*Math.cos(2*Math.PI/pieType*iii)+drawY*Math.sin(2*Math.PI/pieType*iii))
    						pointsYm[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)-drawX*Math.sin(2*Math.PI/pieType*iii)
    					}
    				else
    					{
    						pointsXm[iii]=drawY*Math.cos(2*Math.PI/pieType*iii)+drawX*Math.sin(2*Math.PI/pieType*iii)
    						pointsYm[iii]=drawX*Math.cos(2*Math.PI/pieType*iii)-drawY*Math.sin(2*Math.PI/pieType*iii)
    					}
    			}
    	}
 for (var iiii=1; iiii < pieType+1; iiii++) {
    	
		context2.beginPath();
	    context2.lineWidth = lineThik;
	    context2.moveTo(lastPointX[iiii],lastPointY[iiii]);
		context2.lineTo(pointsX[iiii],pointsY[iiii]);
		context2.lineCap = 'round';
	    context2.strokeStyle = masterina.color;
	    context2.stroke(); 
	    if (mirror==2){
		    context2.beginPath();
		    context2.lineWidth = lineThik;
		    context2.moveTo(lastPointXm[iiii],lastPointYm[iiii]);
			context2.lineTo(pointsXm[iiii],pointsYm[iiii]);
			context2.lineCap = 'round';
		    context2.strokeStyle = masterina.color;
		    context2.stroke(); 
		}
	    } 
	for (var iiiii=1; iiiii < pieType+1; iiiii++) {
	    lastPointX[iiiii]=pointsX[iiiii];
	    lastPointY[iiiii]=pointsY[iiiii];
	    if (mirror==2){
	    	
	    	lastPointXm[iiiii]=pointsXm[iiiii];
	    	lastPointYm[iiiii]=pointsYm[iiiii];
	    }
	   startMove=true;
	}
}
	



function processGyro(alpha,beta,gamma)
{ 
	deviceOrientationData.alpha=alpha;
	deviceOrientationData.beta=beta;
	deviceOrientationData.gamma=gamma;
	
	drawMasterina();

	if (bitTouch)
	{
		
	}
	else
	{
		rotatePointViaGyroEulars(0,startY,startZ);
	}
	
	//positioning();		
	

}



function degToRad(deg)// Degree-to-Radian conversion
{
	 return deg * Math.PI / 180; 
}




//========================================================================================================================================================================
//======================================================================TOUCH==================================================================================================



function touchStartFunc(e)
{
	
}

function touchmoveFunc(e)
{
	if (!(color))
	{
		if( navigator.userAgent.match(/Android/i) ) //stupid android bug cancels touch move if it thinks there's a swipe happening
		{   
		  e.preventDefault();
		}
		touchX=e.touches[0].clientX
		userX=e.touches[0].clientX-firstX;
		userY=e.touches[0].clientY-firstY;
		
		if (!(bitTouch))
		{
			
			firstX=e.touches[0].clientX;
			firstY=e.touches[0].clientY;
			
		}
		if (bitTouch){
			drawPie(userX+x,userY-y)
			
		}
		bitTouch=true;
	 }
}

function touchEndFunc(e)
{
	
  
  userX=0;
	userY=0;
	bitTouch=false;
	startMove=false;
	if (color)
	{
		document.getElementById('myColorCanvas').style.zIndex=0;
		color=false;
	}
	
}

//====================================================================MOUSE=================================================================
document.addEventListener("mousedown", mouseDownFunc, true);
document.addEventListener("mousemove", mouseMoveFunc, true);
document.addEventListener("mouseup", mouseUpFunc, true);


function mouseDownFunc(e)
{
  	bitTouch=true;
  	if ((!(masterina.draw))&&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)>(masterina.radius1-masterina.line/2))
	 &&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)<(masterina.radius2-masterina.line/2)))
	{
		masterina.scale=true;
	}
	if ((!(masterina.draw))&&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)>(masterina.radius2-masterina.line/2))
	 &&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)<(masterina.radius2+masterina.line/2)))
	{
		masterina.move=true;
	}
  	
}

function mouseMoveFunc(e)
{	
	mouseX=e.clientX;mouseY=e.clientY;
	
	if ((!(masterina.move))&&(!(masterina.scale))&&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)<(masterina.radius1-masterina.line/2)))
  	{
  		masterina.draw=true;
  	}
  	else
  	{
  		masterina.draw=false;
  		startMove=false;
  	}
//=================================================================================================DRAW=======================================================	
	if (bitTouch){

		userX=e.clientX;
		userY=e.clientY;
		if (masterina.draw)
		{
			drawPie(userX-masterina.posX, userY-masterina.posY);
		}
//===================================================================================================MOVE==============================================
	if (masterina.move)
	{
		context2.translate(e.clientX-masterina.dX,e.clientY-masterina.dY);
		context.translate(e.clientX-masterina.dX,e.clientY-masterina.dY);
		masterina.posX+=(e.clientX-masterina.dX);masterina.posY+=(e.clientY-masterina.dY);
		drawMasterina();
	}
//=================================================================================================SCALE================================================
	if (masterina.scale){
		if (e.clientX>masterina.posX)
		{
			masterina.radius1+=(e.clientX-masterina.dX);
			masterina.radius2+=(e.clientX-masterina.dX);
		}
		else
		{
			masterina.radius1-=(e.clientX-masterina.dX);
			masterina.radius2-=(e.clientX-masterina.dX);
		}
		if (masterina.radius1<30)
		{
			masterina.radius1=30;masterina.radius2=40;
		}
		drawMasterina();
	}

	}
	
	if ((!(masterina.draw))&&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)>(masterina.radius1-masterina.line/2))
	 &&(Math.sqrt((e.clientX-masterina.posX)**2+(e.clientY-masterina.posY)**2)<(masterina.radius2+masterina.line/2)))
	{
		document.body.style.cursor = 'pointer';
		
	}
	else
	{
		document.body.style.cursor = 'crosshair';
		
	}
	masterina.dX=e.clientX;masterina.dY=e.clientY;
}

function mouseUpFunc(e)
{
   userX=0;
	userY=0;
	bitTouch=false;
	startMove=false;
	masterina.move=false
	masterina.scale=false
	masterina.draw=false;
}


		
 </script>
</html>